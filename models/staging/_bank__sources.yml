version: 2

sources:
  - name: bank
    description: "Fuente de datos bancarios que contiene información sobre cuentas, clientes, dispositivos, transacciones, etc."
    schema: bank
    database: BANK_AROA_BRONZE

    freshness:
      warn_after: { count: 24, period: day }
      error_after: { count: 48, period: day }

    tables:
      - name: account
        description: "Información sobre las cuentas bancarias de los clientes, incluyendo tipo de cuenta, saldo, límite de descubierto, etc."
        tests:
          - dbt_utils.unique_combination_of_columns:
              combination_of_columns: ["account_id", "customer_id"] # IDs únicos por cliente y cuenta
          - dbt_utils.relationships:
              to: ref('customers')
              field: customer_id # Asegura la relación con la tabla customers
        columns:
          - name: account_id
            description: "ID único de la cuenta bancaria."
            tests:
              - unique
              - not_null
          - name: balance
            description: "Saldo actual de la cuenta."
            tests:
              - not_null
              - dbt_utils.accepted_range:
                  min_value: 0 # Los saldos deben ser 0 o mayores
          - name: customer_id
            description: "ID del cliente asociado a la cuenta."
            tests:
              - not_null
              - dbt_utils.relationships:
                  to: ref('customers')
                  field: customer_id # Relación con la tabla de clientes
          - name: account_type
            description: "Tipo de cuenta (e.g., corriente, ahorro)."
            tests:
              - not_null
          - name: last_activity
            description: "Fecha y hora de la última actividad en la cuenta."
            tests:
              - not_null
          - name: overdraft_limit
            description: "Límite de descubierto de la cuenta, si aplica."
          - name: account_status
            description: "Estado de la cuenta (e.g., activa, cerrada)."
            tests:
              - not_null
          - name: date_opened
            description: "Fecha en que se abrió la cuenta."
            tests:
              - not_null
          - name: _fivetran_synced
            description: "Marca temporal de la última sincronización con Fivetran."
            tests:
              - not_null

      - name: customers
        description: "Información sobre los clientes del banco, incluyendo datos demográficos y comportamiento de gasto."
        columns:
          - name: customer_id
            description: "ID único del cliente."
            tests:
              - unique
              - not_null
          - name: email
            description: "Correo electrónico del cliente."
            tests:
              - not_null
              - email_format
          - name: total_spent
            description: "Monto total gastado por el cliente."
            tests:
              - not_null
          - name: country
            description: "País de residencia del cliente."
            tests:
              - not_null
          - name: registration_date
            description: "Fecha de registro del cliente en el sistema."
            tests:
              - not_null
          - name: gender
            description: "Género del cliente."
          - name: date_of_birth
            description: "Fecha de nacimiento del cliente."
            tests:
              - not_null
          - name: is_vip
            description: "Indica si el cliente es VIP (Sí/No)."
          - name: name
            description: "Nombre completo del cliente."
            tests:
              - not_null
          - name: average_transaction
            description: "Promedio de transacciones realizadas por el cliente."
          - name: phone_number
            description: "Número de teléfono del cliente."
          - name: _fivetran_synced
            description: "Marca temporal de la última sincronización con Fivetran."
            tests:
              - not_null
      - name: device
        description: "Información sobre los dispositivos asociados a los clientes"
        columns:
          - name: device_id
            description: "ID único del dispositivo"
          - name: device_type
            description: "Tipo de dispositivo"
          - name: ip_address
            description: "Dirección IP asociada al dispositivo"
          - name: customer_id
            description: "ID del cliente asociado al dispositivo"
          - name: geo_id
            description: "ID de geolocalización del dispositivo"
          - name: _fivetran_synced
            description: "Marca temporal de la última sincronización con Fivetran"

      - name: geolocation
        description: "Información geográfica asociada a los dispositivos, incluyendo si es un proxy."
        columns:
          - name: country
            description: "País desde el que se accede al dispositivo."
          - name: city
            description: "Ciudad desde la que se accede al dispositivo."
          - name: is_proxy
            description: "Indica si la conexión proviene de un servidor proxy."
          - name: geo_id
            description: "ID único de geolocalización."
            tests:
              - unique
              - not_null
          - name: _fivetran_synced
            description: "Marca temporal de la última sincronización con Fivetran."
            tests:
              - not_null

      - name: merchant
        description: "Información sobre los comerciantes, incluyendo el riesgo y las ventas."
        columns:
          - name: merchant_id
            description: "ID único del comerciante."
            tests:
              - unique
              - not_null
          - name: merchant_name
            description: "Nombre del comerciante."
            tests:
              - not_null
          - name: merchant_risk_score
            description: "Puntuación de riesgo del comerciante."
          - name: total_sales
            description: "Ventas totales realizadas por el comerciante."
          - name: merchant_category
            description: "Categoría del comerciante (e.g., tecnología, ropa)."
          - name: geo_id
            description: "ID de geolocalización del comerciante."
          - name: _fivetran_synced
            description: "Marca temporal de la última sincronización con Fivetran."
            tests:
              - not_null

      - name: transaction
        description: "Información de las transacciones bancarias, incluyendo monto, estado, tipo, etc."
        columns:
          - name: transaction_id
            description: "ID único de la transacción."
            tests:
              - unique
              - not_null
          - name: amount
            description: "Monto de la transacción."
            tests:
              - not_null
              - dbt_utils.accepted_range:
                  min_value: 0 # Puedes ajustar el valor mínimo
                  max_value: 99990 # Los valores deben ser menores o iguales a 0
          - name: transaction_status
            description: "Estado de la transacción (completada, fallida, pendiente)."
            tests:
              - not_null
          - name: device_id
            description: "ID del dispositivo utilizado para la transacción."
          - name: exchange_rate
            description: "Tipo de cambio utilizado en la transacción (si aplica)."
          - name: channel
            description: "Canal utilizado para la transacción (e.g., en línea, presencial)."
          - name: merchant_id
            description: "ID del comerciante donde se realizó la transacción."
          - name: transaction_type
            description: "Tipo de transacción (e.g., compra, reembolso)."
          - name: account_id
            description: "ID de la cuenta asociada con la transacción."
          - name: currency
            description: "Moneda utilizada para la transacción."
          - name: merchant_rating
            description: "Puntuación del comerciante para la transacción."
          - name: timestamp
            description: "Fecha y hora en que ocurrió la transacción."
            tests:
              - not_null
          - name: _fivetran_synced
            description: "Marca temporal de la última sincronización con Fivetran."
            tests:
              - not_null
